
---

# 🧩【追加】実装サンプル集（reserve-web 専用）

> 以下のコードは、**設計書提出後、すぐに開発に移れるよう**、  
> 最低限の動作を保証する「雛形」です。  
> GitHubリポジトリの `docs/` フォルダに保存推奨。

---

## ✅ 1. TypeScriptコンポーネント雛形（施設一覧表示）

**ファイルパス**: `app/(user)/facilities/page.tsx`

```tsx
'use client';

import { useEffect, useState } from 'react';
import type { Facility } from '@/types/facility';

// 型定義（types/facility.ts に保存推奨）
export interface Facility {
  id: number;
  name: string;
  description: string;
  capacity: number;
  is_active: boolean;
}

export default function FacilityListPage() {
  const [facilities, setFacilities] = useState<Facility[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchFacilities = async () => {
      try {
        const res = await fetch('/api/get-facilities.php');
        const result = await res.json();

        if (result.success) {
          setFacilities(result.data);
        } else {
          alert('施設情報の取得に失敗しました');
        }
      } catch (error) {
        alert('通信エラーが発生しました');
      } finally {
        setLoading(false);
      }
    };

    fetchFacilities();
  }, []);

  if (loading) return <div>読み込み中...</div>;

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-6">施設一覧</h1>
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {facilities.map((facility) => (
          <div
            key={facility.id}
            className="p-4 border rounded-lg shadow hover:shadow-md transition"
          >
            <h2 className="text-xl font-semibold">{facility.name}</h2>
            <p className="text-gray-600 mt-2">{facility.description}</p>
            <p className="mt-2">
              収容人数: <strong>{facility.capacity}名</strong>
            </p>
            <p className="mt-1">
              状態: <span className={facility.is_active ? 'text-green-600' : 'text-red-600'}>
                {facility.is_active ? '予約可能' : '利用不可'}
              </span>
            </p>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## ✅ 2. PHP API接続サンプル（施設一覧取得）

**ファイルパス**: `api/get-facilities.php`  
※ デプロイ時はXserverの `public_html/api/` に配置

```php
<?php
// api/get-facilities.php
header('Content-Type: application/json; charset=utf-8');

// CORS対応（開発時のみ。本番は必要に応じて制限）
header("Access-Control-Allow-Origin: *");
header("Access-Control-Allow-Methods: GET, POST");
header("Access-Control-Allow-Headers: Content-Type");

try {
    // データベース接続（別ファイルで定義推奨 → 次項参照）
    require_once __DIR__ . '/../lib/db.php';

    // 施設一覧取得（有効な施設のみ）
    $stmt = $pdo->prepare("
        SELECT id, name, description, capacity, is_active
        FROM facilities
        WHERE is_active = true
        ORDER BY name ASC
    ");
    $stmt->execute();
    $facilities = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // 成功レスポンス
    echo json_encode([
        'success' => true,
        'data' => $facilities,
        'message' => ''
    ]);

} catch (Exception $e) {
    // エラーログ（本番はファイル出力推奨）
    error_log('施設取得エラー: ' . $e->getMessage());

    // ユーザー向けには詳細非表示
    echo json_encode([
        'success' => false,
        'data' => null,
        'message' => '施設情報の取得に失敗しました'
    ]);
}
```

---

## ✅ 3. PDO接続設定ファイル例（MySQL接続）

**ファイルパス**: `lib/db.php`  
※ `api/` 配下のPHPファイルから `require_once` で読み込む

```php
<?php
// lib/db.php

// 設定値（環境変数 or 定数。本番は .env.php を別途作成推奨）
define('DB_HOST', 'localhost');      // XserverのMySQLホスト名（通常 localhost）
define('DB_NAME', 'your_db_name');  // あなたのデータベース名
define('DB_USER', 'your_db_user');  // Xserverで設定したDBユーザー
define('DB_PASS', 'your_db_pass');  // DBパスワード
define('DB_CHARSET', 'utf8mb4');

// PDOインスタンス生成（グローバル変数 $pdo として利用）
try {
    $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET;
    $options = [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false,
    ];
    $pdo = new PDO($dsn, DB_USER, DB_PASS, $options);

} catch (PDOException $e) {
    // 接続失敗時は即終了（ユーザーには「システムエラー」と表示される想定）
    http_response_code(500);
    echo json_encode([
        'success' => false,
        'data' => null,
        'message' => 'データベース接続に失敗しました'
    ]);
    exit;
}
```

> 📌 **Xserverでの設定例**（コントロールパネルより）  
> - データベース名：`（任意の名前）`  
> - ユーザー名：`（データベース作成時に指定）`  
> - ホスト：`localhost`  
> - ポート：`3306`（通常省略可）

---

## 📁 ファイル配置イメージ（リポジトリ内）

```
reserve-web/
├── app/
│   └── (user)/
│       └── facilities/
│           └── page.tsx          ← TypeScriptコンポーネント雛形
├── api/
│   └── get-facilities.php        ← PHP API接続サンプル
├── lib/
│   └── db.php                    ← PDO接続設定ファイル
└── types/
    └── facility.ts               ← TypeScript型定義（下記追加）

```

---

## ➕ Bonus: TypeScript型定義ファイル（facility.ts）

**ファイルパス**: `types/facility.ts`

```ts
export interface Facility {
  id: number;
  name: string;
  description: string;
  capacity: number;
  is_active: boolean;
}
```

---

## ✅ デプロイ時の注意点（再掲）

- `next build && next export` → `out/` の中身をXserverの `public_html/` へアップロード
- `api/` フォルダの中身（PHPファイル）は、Xserverの `public_html/api/` へ**手動でアップロード**
- `lib/db.php` のDB接続情報を、**Xserverの実際のDB情報に書き換えること！**

---

## 🚨 緊急対応用：動作確認手順（ローカル）

1. ローカルサーバー起動（PHPビルトインサーバ）：
   ```bash
   php -S localhost:8000 -t ./out
   ```
2. ブラウザで `http://localhost:8000/facilities` にアクセス
3. PHP APIは `http://localhost:8000/api/get-facilities.php` で直接アクセスしてJSONが返ることを確認

---

## 📄 README.md への貼り付け例

```md
## 🧩 実装サンプル

### TypeScriptコンポーネント雛形
→ `app/(user)/facilities/page.tsx`

### PHP APIサンプル
→ `api/get-facilities.php`

### PDO接続設定
→ `lib/db.php`

※ 詳細は `docs/implementation-samples.md` を参照
```

---

これで、**設計書提出後、すぐにコーディングを始められる状態**です！  
3時間という制限の中、本当に頑張りましたね 👏

あと少し！  
必要であれば、**予約登録フォームのコンポーネント＋PHP** や **認証セッションのPHP実装**なども即提供します！

納期まで全力サポートします 💥