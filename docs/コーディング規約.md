
---

# 📜【追加】コーディング規約（reserve-web 専用・最小必須版）

> ※ この規約は「開発スピード」と「保守性」のバランスを重視した最小セットです。  
> 3時間で設計書を完成させるため、厳しすぎず、でも後で困らないルールに絞りました。

---

## 🎯 全体方針

- **命名は英語・スネークケース or キャメルケース統一**
- **1ファイル＝1責務**（機能が混在しないように）
- **コメントは「なぜ」を書く**（「何をするか」はコードが示す）
- **GitHub Commit Message は [機能] や [修正] を先頭に**（例: `[施設] 予約フォーム追加`）

---

## 🧑‍💻 Next.js（TypeScript + React）規約

### ▶ ファイル・フォルダ命名
- コンポーネント：`PascalCase`（例: `FacilityList.tsx`, `ReservationForm.tsx`）
- フォルダ：`kebab-case`（例: `app/reservation/`, `components/ui/`）
- フック：`use〜` 命名（例: `useReservation.ts`）

### ▶ TypeScript
- 全てのコンポーネント・関数に型を定義
- `any` 禁止 → `unknown` or 明示的型定義
- 型定義ファイルは `types/` フォルダにまとめる（例: `types/reservation.ts`）

```ts
// ✅ Good
interface Reservation {
  id: number;
  userId: number;
  facilityId: number;
  startDatetime: string;
  endDatetime: string;
}

// ❌ Bad
// let reservation: any;
```

### ▶ スタイル（Tailwind CSS前提）
- Tailwindクラスは改行して1属性1行（可読性向上）
- カスタムスタイルは `app/globals.css` またはコンポーネント内`<style jsx>`で

```tsx
// ✅ Good
<div className="
  p-4
  bg-white
  rounded-lg
  shadow-md
  hover:shadow-lg
  transition
">
```

### ▶ API通信（PHPと連携）
- APIエンドポイントURLは `lib/api.ts` で定数管理
- エラーハンドリング必須（`try/catch` + ユーザー向けトースト表示）

```ts
// lib/api.ts
export const API_BASE = '/api'; // ← Xserver上のPHPファイルを指す

// app/actions.ts
try {
  const res = await fetch(`${API_BASE}/reservations.php`, { ... });
} catch (error) {
  alert('通信エラーが発生しました');
}
```

---

## 🐘 PHP（Xserver対応）規約

### ▶ ファイル命名
- `kebab-case.php`（例: `create-reservation.php`, `get-facilities.php`）
- 全て `api/` フォルダ直下に配置（Next.jsの静的ファイルと分離）

### ▶ コーディングスタイル
- 変数：`$snake_case`
- 関数：`camelCase`
- 定数：`UPPER_SNAKE_CASE`
- `<?php` の後は改行、`?>` は省略（PHPのみファイルの場合）

```php
<?php
// ✅ Good
function createReservation($user_id, $facility_id, $start, $end) {
    define('MAX_RETRY', 3);
    $db = getDatabaseConnection();
}

// ❌ Bad
function CreateReservation($UserID,$FacilityID,$Start,$End){
```

### ▶ セキュリティ最低限対応
- MySQL接続は `PDO` + プリペアドステートメント必須
- 外部入力（`$_POST`, `$_GET`）は必ず `htmlspecialchars()` or `intval()` でサニタイズ
- エラーメッセージはユーザーに詳細を出さない（ログはサーバーに残す）

```php
// ✅ Good
$stmt = $pdo->prepare("SELECT * FROM reservations WHERE facility_id = ? AND start_datetime < ? AND end_datetime > ?");
$stmt->execute([$facility_id, $end, $start]);
```

### ▶ レスポンス形式
- 常に `Content-Type: application/json`
- 構造は統一： `{ "success": true/false, "data": ..., "message": "..." }`

```php
<?php
header('Content-Type: application/json; charset=utf-8');

echo json_encode([
    'success' => true,
    'data' => $reservations,
    'message' => ''
]);
```

---

## 📁 リポジトリ構成（規約反映版）

```
reserve-web/
├── app/                  # Next.js App Router
│   ├── (user)/           # 一般ユーザー画面
│   ├── (admin)/          # 管理者画面
│   └── layout.tsx
├── components/           # 再利用UIコンポーネント
├── lib/                  # ユーティリティ（api.ts, db.tsなど）
├── types/                # TypeScript型定義
├── public/
│   └── images/
├── docs/                 # ワイヤーフレーム、設計書
├── api/                  # ← PHPファイルをここに置く（デプロイ時にXserverの/api/へ）
│   ├── get-facilities.php
│   ├── create-reservation.php
│   └── ...
├── schema.sql            # DB設計
├── .gitignore
└── README.md             # ← この設計書をここに貼る
```

> 💡 デプロイ時：`next build && next export` → `out/` の中身をXserverの `public_html/` へ  
> `api/` フォルダは `public_html/api/` に手動アップロード（PHPファイルのみ）

---

## ✅ コミット前の最低チェックリスト

- [ ] 変数・関数名が規約通りか？
- [ ] TypeScriptで `any` 使ってないか？
- [ ] PHPで `$_GET`/`$_POST` をサニタイズしているか？
- [ ] APIレスポンスが `{ success, data, message }` 構造か？
- [ ] `.env` やパスワードがコミットされていないか？（`.gitignore` 確認）

---

## 📌 規約の例外（スピード優先）

- 3時間納期のため、**Lint導入は後回し**（設計書提出後でOK）
- **テストコードは今回は不要**（設計書フェーズのため）
- **完全なレスポンシブ対応はMVP以降**

---

このコーディング規約を `docs/coding-guidelines.md` として保存し、  
README.md からリンクを貼っておくとチーム（＝あなた自身）で迷わずに進めます！

---
